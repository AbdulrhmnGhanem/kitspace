gitlab:
  image: 'gitlab/gitlab-ce:11.0.0-rc13.ce.0'
  restart: always
  environment:
    GITLAB_OMNIBUS_CONFIG: |
      external_url "${GITLAB_DOMAIN}:${PORT}/${GITLAB_PATH}"
      gitlab_rails['omniauth_enabled'] = true
      gitlab_rails['omniauth_allow_single_sign_on'] = ['github']
      gitlab_rails['omniauth_block_auto_created_users'] = false
      gitlab_rails['omniauth_providers'] = [
         {
             "name" => "github",
             "app_id" => "${OAUTH_GITHUB_APP_ID}",
             "app_secret" => "${OAUTH_GITHUB_APP_SECRET}"
             #"args" => { "access_type" => "offline", "approval_prompt" => "" }
         }
       ]
  ports:
    - '${GITLAB_PORT}:${PORT}'
    - '8022:22'
  volumes:
    - '/srv/gitlab/config:/etc/gitlab'
    - '/srv/gitlab/logs:/var/log/gitlab'
    - '/srv/gitlab/data:/var/opt/gitlab'
nginx:
  image: 'nginx:1.13.10-alpine'
  volumes:
    - './nginx:/etc/nginx/conf.d'
  ports:
   - '${PORT}:80'
